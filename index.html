<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Dubhacks 2017</title>
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
</head>

<body>
    <header>
        <div class="container">
            <h1 class="site-title">Emotion Aware</h1>
            <p class="sub-heading">what is going on behind the words?</p>
        </div>
    </header>

    <div id="container">
        <p>Live Video</p>

        <video autoplay></video>
        <div id="my_camera"></div>

        <img src="">
        <canvas class="canvas" width="1000" height="1000"></canvas>
        <button onclick="start()">Start</button>
        <button onclick="stop()">Stop</button>
        <button onclick="start_snapping()">Snapshot</button>
        <div id="results"></div>
        <a id="dl-btn" href="#" download="glorious_selfie.png">Save Photo</a>
<script type="text/javascript" src="webcam.min.js"></script>
        <script>
            var canvas = document.querySelector('canvas');
            // var ctx = canvas.getContext('2d');
            var localMediaStream = null;


            var video = document.querySelector('video');
            var canvas = document.querySelector('canvas');
            var snapshots = [];





            function snapshot() {
                console.log("snapshot")

                //             if (navigator.getUserMedia) {
                //                 //   ctx.drawImage(video, 0, 0);
                //                 // "image/webp" works in Chrome.
                //                 // Other browsers will fall back to image/png.
                //                 document.querySelector('video').src = canvas.toDataURL('image/webp');
                //                 console.log(canvas.toDataURL('image/webp'))
                //                 snapshots.push(canvas.toDataURL('image/webp'))

                // var img = new Image();
                //             	img.src = canvas.toDataURL('image/webp');

                //             	document.getElementById('results').appendChild( img );


                //             }
                //             console.log(snapshots);


                //     var ctx = canvas.getContext('2d');
                // ctx.drawImage(video,100,100);


// webcam.snap( function(data_uri) {
//   // display results in page
//   document.getElementById('results').innerHTML = 
//   '<img src="'+data_uri+'"/>';
// } );

                if (navigator.getUserMedia) {
                    var  width = video.videoWidth;
       var height = video.videoHeight;
                    canvas.getContext("2d").drawImage(video, 0, 0, 500, 500, 0, 0, width, height);

                    var img = document.querySelector('img') || document.createElement('img');

                    // var img = canvas.toDataURL("image/png");
                          img.src = canvas.toDataURL('image/png');
      document.body.appendChild(img);
                    snapshots.push(img.src);
                        document.querySelector('#dl-btn').href = img.src;

                }

                console.log(snapshots);
            }


            var errorCallback = function (e) {
                console.log('Reeeejected!', e);
            };


            function fallback(e) {
                video.src = 'fallbackvideo.webm';
            }

            function success(stream) {
                video.src = window.URL.createObjectURL(stream);
            }

            navigator.getUserMedia = navigator.getUserMedia ||
                navigator.webkitGetUserMedia ||
                navigator.mozGetUserMedia ||
                navigator.msGetUserMedia;

            var video = document.querySelector('video');
            // Not showing vendor prefixes.

            function start() {
                if (!navigator.getUserMedia) {
                    fallback();
                } else {
                    var localMediaStream = null;
                    if (navigator.getUserMedia) {
                        navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(function (localMediaStream) {
                            video = document.querySelector('video');
                            video.srcObject = localMediaStream;
                        })
                    } else {
                        video.src = 'somevideo.webm'; // fallback.
                    }
                    ;
                }
            }
            function stop() {
                video.srcObject = null;
                video.stop;
                stop_snapping();
            }

            var timer = null;

            function take_snapshot() {
                // take snapshot and get image data
                // Webcam.snap( function(data_uri) {
                // 	// display results in page
                // 	var img = new Image();
                // 	img.src = data_uri;

                // 	document.getElementById('results').appendChild( img );
                // } );
                snapshot();
            }

            function start_snapping() {
                if (!timer) {
                    take_snapshot();
                    timer = setInterval(take_snapshot, 1000);
                }
            }

            function stop_snapping() {
                if (timer) {
                    clearTimeout(timer);
                    timer = null;
                }
            }
        </script>
    </div>

    <main>
        <form action="#">
            <p>image upload</p>
            <input type="file" name="pic" accept="image/*">
            <input type="submit">
        </form>

        <form action="#">
            <p>video upload</p>
            <input type="file" name="vid" accept="video/*">
            <input type="submit">
        </form>

        <form action="#">
            <p>audio upload</p>
            <input type="file" name="vid" accept="audio/*">
            <input type="submit">
        </form>

    </main>
    

</body>

</html>